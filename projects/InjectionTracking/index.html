<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Injection Site Tracking | Frank L. Martin </title> <meta name="author" content="Frank L. Martin"> <meta name="description" content="Finding a region of interest using a hand-drawn X-mark."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://frankmartiniii.github.io/projects/InjectionTracking/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Frank</span> L. Martin </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/news/">News </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Injection Site Tracking</h1> <p class="post-description">Finding a region of interest using a hand-drawn X-mark.</p> </header> <article> <p>We are developing a robot that can deliver injections. Our goal is to make robots that be easily controlled by human operators and doctors. I wanted to take on the challenging task of building a system that naturally fits into a clinical setting without too much change the routine of medical staff. To integrate a robot for injection as seamlessly as possible, it was logical to me that we would want to allow doctors and nurses to easily mark an area on the skin, akin to what they might do before a surgical procedure, and have the robotic system automatically acquire and track the region of interest from these markings.</p> <p>I came up with multiple ideas to accomplish this, conducting many experiments with ellipse fitting, circle detection, and contour tracking. Ultimately, we settled on the idea of using an X shape. Why? An X is easy for a human to draw, has an exact point of interest, and is intuitive for a human to understand. Regardless of the size and shape of the X, it is obvious that the injection should be delivered at the intersection point, though detecting this with computer vision and retrieving a full 6 degree-of-freedom pose is more challenging.</p> <p>OpenCV has no built-in solution for detecting a hand-drawn X, so I created a method for this purpose. This solution does not use machine learning.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/image-480.webp 480w,/assets/img/XDetection/image-800.webp 800w,/assets/img/XDetection/image-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/image.png" class="img-fluid rounded z-depth-1 w-50" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>First, I masked out the desired area using thresholding and various morphological operations. These steps help to reduce noise caused by hair and other features on the skin.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/image1-480.webp 480w,/assets/img/XDetection/image1-800.webp 800w,/assets/img/XDetection/image1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/image1.png" class="img-fluid rounded z-depth-1 w-100" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>This area is too thick to consistently detect lines, so I proceeded by applying morphological skeletonization to the developed mask. After doing this, we can actually find line segments in the image using the Hough transform.</p> <div class="row"> <div class="col-sm mt-5 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/image2-480.webp 480w,/assets/img/XDetection/image2-800.webp 800w,/assets/img/XDetection/image2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/image2.png" class="img-fluid rounded z-depth-1 w-100" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-5 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/LineSegs-480.webp 480w,/assets/img/XDetection/LineSegs-800.webp 800w,/assets/img/XDetection/LineSegs-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/LineSegs.png" class="img-fluid rounded z-depth-1 w-100" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I clustered the lines into two groups and used RANSAC on the end points to determine the dominant lines that make up the X. It is then straightforward to find the intersection point and map it back to the original image. This method works very well even in more complex examples with a lot of adversarial features.</p> <div class="row"> <div class="col-sm mt-5 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/image3-480.webp 480w,/assets/img/XDetection/image3-800.webp 800w,/assets/img/XDetection/image3-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/image3.png" class="img-fluid rounded z-depth-1 w-100" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-5 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/image4-480.webp 480w,/assets/img/XDetection/image4-800.webp 800w,/assets/img/XDetection/image4-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/image4.png" class="img-fluid rounded z-depth-1 w-100" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>This one point does not provide enough information to find the full 3D pose. I needed a way to at least move the robot into a position parallel to the skin’s surface and over the general region of interest. Since the region is quite small, we could consider it approximately planar. Defining a plane requires 3 non-collinear points, and finding its pose in world space first requires the XYZ coordinates of those points in the camera frame, which can then be transformed to the world coordinate system. For this, I created and calibrated a stereo camera setup to triangulate these points. Instead of drawing more features on the skin, we can search for matching features across our stereo pair. To do this, I segmented a small area around the intersection point in the two images, which we can find using the above method on two stereo aligned images.</p> <div class="row"> <div class="col-sm mt-5 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/StereoAligned-480.webp 480w,/assets/img/XDetection/StereoAligned-800.webp 800w,/assets/img/XDetection/StereoAligned-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/StereoAligned.png" class="img-fluid rounded z-depth-1 w-100" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I then used Shi-Tomasi corner detection, SIFT, and Brute-Force matcher to find matching keypoints. Then, the coordinates of the top matches can be triangulated and then used with RANSAC to fit a plane.</p> <div class="row"> <div class="col-sm mt-5 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/FeaturePts-480.webp 480w,/assets/img/XDetection/FeaturePts-800.webp 800w,/assets/img/XDetection/FeaturePts-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/FeaturePts.png" class="img-fluid rounded z-depth-1 w-100" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm mt-5 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/MatchedPts-480.webp 480w,/assets/img/XDetection/MatchedPts-800.webp 800w,/assets/img/XDetection/MatchedPts-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/MatchedPts.png" class="img-fluid rounded z-depth-1 w-100" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Best matched feature points with distances. </div> <div class="row"> <div class="col-sm mt-5 mt-md-0 text-center"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/XDetection/CamFrame-480.webp 480w,/assets/img/XDetection/CamFrame-800.webp 800w,/assets/img/XDetection/CamFrame-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/XDetection/CamFrame.png" class="img-fluid rounded z-depth-1 w-100" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Coordinates of matched points in camera frame. </div> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Frank L. Martin. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>